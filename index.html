<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ë™ì‚° ê°œë°œ : íƒ€ì´ë°ì˜ ìŠ¹ë¶€ì‚¬</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; }
        .preserve-3d { transform-style: preserve-3d; }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.3s ease-out forwards; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-950 text-white flex justify-center items-center min-h-screen overflow-hidden select-none">
    <div id="root" class="w-full max-w-md h-full max-h-screen flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Constants & Data ---
        const INITIAL_UNIT_COST = 3.0;
        const MIN_RATE = 1.0; 
        const MAX_RATE = 15.0; 
        const CONSTRUCTION_DURATION = 36;
        const START_AGE = 30;
        const START_YEAR = 2010;
        const END_YEAR = 2025;
        const TOTAL_GAME_MONTHS = (END_YEAR - START_YEAR) * 12;
        const MAX_ROUNDS = 5; 
        const TICK_RATE = 500; 

        const HISTORICAL_TRENDS = {
            2010: { priceM: 0.9, rate: 4.5 }, 
            2011: { priceM: 0.92, rate: 4.5 },
            2012: { priceM: 0.88, rate: 4.0 }, 
            2013: { priceM: 0.9, rate: 3.5 }, 
            2014: { priceM: 1.0, rate: 3.0 }, 
            2015: { priceM: 1.15, rate: 2.5 }, 
            2016: { priceM: 1.25, rate: 2.25 },
            2017: { priceM: 1.4, rate: 2.5 }, 
            2018: { priceM: 1.6, rate: 2.75 }, 
            2019: { priceM: 1.7, rate: 2.5 }, 
            2020: { priceM: 2.0, rate: 1.0 }, 
            2021: { priceM: 2.5, rate: 1.5 }, 
            2022: { priceM: 2.2, rate: 5.0 }, 
            2023: { priceM: 1.9, rate: 6.5 }, 
            2024: { priceM: 2.0, rate: 5.0 }, 
            2025: { priceM: 2.1, rate: 4.0 }, 
        };

        const NPC_EVENTS = [
            { trigger: (s) => s.gameState === 'idle', speaker: "ê¹€ ë¹„ì„œ", role: "ì¼ì˜ëŸ¬", msg: "ì‚¬ì¥ë‹˜, ë‹¤ìŒ ì‚¬ì—…ì§€ëŠ” ì–´ë””ë¡œ í• ê¹Œìš”? ê°•ë‚¨? íŒêµ? ì•„ë‹ˆë©´ í™”ì„±?", icon: "fa-user-clock", color: "text-pink-300", chance: 0.05 },
            { trigger: (s) => s.marketRate > 8.0, speaker: "ì´ ì¬ë¬´ì´ì‚¬", role: "ê±±ì •ì¸í˜•", msg: "ì‚¬ì¥ë‹˜! ê¸ˆë¦¬ê°€ ë¯¸ì³¤ìŠµë‹ˆë‹¤! ì´ëŸ¬ë‹¤ íšŒì‚¬ ì‚¬ì˜¥ íŒ”ì•„ì•¼ í•©ë‹ˆë‹¤ ã… ã… ", icon: "fa-chart-line", color: "text-red-300", chance: 0.08 },
            { trigger: (s) => s.gameState === 'under_construction' && s.marketPrice > s.fixedSalesPrice * 1.3, speaker: "ì˜¤ í™ë³´íŒ€", role: "ì‹ ë‚¨", msg: "ì‚¬ì¥ë‹˜! ìš°ë¦¬ ì•„íŒŒíŠ¸ê°€ 'ë¡œë˜ ì²­ì•½'ì´ë˜ìš”! ê²½ìŸë¥  1000:1 ì˜ˆìƒí•©ë‹ˆë‹¤!", icon: "fa-face-laugh-squint", color: "text-orange-300", chance: 0.15 },
            { trigger: (s) => s.gameState === 'under_construction' && s.marketPrice < s.fixedSalesPrice * 0.85, speaker: "í˜„ì¥ ì†Œì¥", role: "í˜„ì‹¤ì ", msg: "ë¶„ìœ„ê¸° ì•ˆ ì¢‹ìŠµë‹ˆë‹¤. ë§ˆí”¼ 1ì–µì—ë„ ì•ˆ íŒ”ë¦°ë‹µë‹ˆë‹¤. ê³µì‚¬ ë©ˆì¶œê¹Œìš”?", icon: "fa-helmet-safety", color: "text-gray-300", chance: 0.15 },
            { speaker: "ë°• ëŒ€ë¦¬", role: "MZì„¸ëŒ€", msg: "ì‚¬ì¥ë‹˜, ì € ì˜¤ëŠ˜ ì¡°í‡´ ì¢€... ì½”ì¸ ë–¡ë½í•´ì„œ ë©˜íƒˆ ë‚˜ê°”ìŠµë‹ˆë‹¤.", icon: "fa-bitcoin-sign", color: "text-yellow-500", chance: 0.05 },
            { speaker: "ê±´ë¬¼ì£¼", role: "ê°“ë¬¼ì£¼", msg: "ì›”ì„¸ ë°€ë¦° ê±° ì•Œê³  ìˆì§€? ë³´ì¦ê¸ˆì—ì„œ ê¹ë‹¤?", icon: "fa-key", color: "text-green-400", chance: 0.05 },
        ];

        const RealEstateTycoon = () => {
            // --- Game Flow ---
            const [gameState, setGameState] = useState('intro');
            const [gameSpeed, setGameSpeed] = useState(1);
            const [round, setRound] = useState(1);
            const [month, setMonth] = useState(0); 
            const [projectMonth, setProjectMonth] = useState(0); 

            // --- Project Variables ---
            const [totalUnits, setTotalUnits] = useState(100);
            const [projectCost, setProjectCost] = useState(300);
            const [totalLoanAmount, setTotalLoanAmount] = useState(270);
            const [fixedSalesPrice, setFixedSalesPrice] = useState(0); 
            const [activeLoan, setActiveLoan] = useState(0); 
            const [salesBoostLeft, setSalesBoostLeft] = useState(0); 

            // Cost Trackers
            const [landCostPerUnit, setLandCostPerUnit] = useState(1.0); 
            const [constCostPerUnit, setConstCostPerUnit] = useState(2.0); 

            // --- Economy & Market ---
            const [marketRate, setMarketRate] = useState(4.5); 
            const [marketPrice, setMarketPrice] = useState(2.5); 
            const [prevMarketPrice, setPrevMarketPrice] = useState(2.5); 
            const [peakPrice, setPeakPrice] = useState(2.5);
            const [priceMomentum, setPriceMomentum] = useState(0); 
            const [fixedInterestRate, setFixedInterestRate] = useState(0); 

            // --- News & Events ---
            const [currentNews, setCurrentNews] = useState(null); 
            const [npcMessage, setNpcMessage] = useState(null); 
            const [pendingEvents, setPendingEvents] = useState([]); 
            const [warningMsg, setWarningMsg] = useState(null);

            // --- Player Status ---
            const [cash, setCash] = useState(70); 
            const [totalRevenue, setTotalRevenue] = useState(0);
            const [unsoldUnits, setUnsoldUnits] = useState(100);
            const [soldUnits, setSoldUnits] = useState(0);
            
            const [history, setHistory] = useState([]); 
            const [logs, setLogs] = useState([]);

            // --- Leaderboard ---
            const [leaderboard, setLeaderboard] = useState([]);
            const [playerName, setPlayerName] = useState("");
            const [scoreSubmitted, setScoreSubmitted] = useState(false);

            // --- Effects ---
            const fetchLeaderboard = () => {
                const stored = localStorage.getItem('tycoon_leaderboard');
                if (stored) {
                    const parsed = JSON.parse(stored);
                    parsed.sort((a, b) => b.score - a.score);
                    setLeaderboard(parsed.slice(0, 10));
                }
            };

            useEffect(() => {
                if (['ended', 'bankrupt', 'time_limit', 'retired'].includes(gameState)) {
                    fetchLeaderboard();
                }
            }, [gameState]);

            // --- Helpers ---
            const triggerNpcMessage = (speaker, role, msg, icon="fa-comment", color="text-white") => {
                setNpcMessage(null);
                setTimeout(() => {
                    setNpcMessage({ speaker, role, msg, icon, color, expireMonth: month + 6 });
                }, 50);
            };

            const getNews = (rate, price, landCost) => {
                const isHighRate = rate > 6.0;
                const isLowRate = rate < 3.0;
                const isCrash = price < landCost * 1.5; 

                const scenarios = [];
                if (isHighRate) {
                    scenarios.push({ type: 'PRICE', impact: -0.5, delay: 2, msg: "ì´ì í­íƒ„! 'ì˜ëŒì¡±' ë¹„ëª…... ê²½ë§¤ ë¬¼ê±´ ê¸‰ì¦", bad: true });
                    scenarios.push({ type: 'PRICE', impact: -0.3, delay: 1, msg: "ê±´ì„¤ì‚¬ ìê¸ˆë‚œ, 'PF ëŒ€ì¶œ' ì—°ì¥ ê±°ë¶€ ì†ì¶œ", bad: true });
                }
                if (isLowRate) {
                    scenarios.push({ type: 'PRICE', impact: 0.6, delay: 3, msg: "'ìê³  ì¼ì–´ë‚˜ë©´ 1ì–µ?' ì „êµ­ ë¶€ë™ì‚° ë¶ˆì¥", bad: false });
                    scenarios.push({ type: 'RATE', impact: 0.5, delay: 4, msg: "ê°€ê³„ ë¶€ì±„ ê²½ê³ ë“±! í•œì€, ê¸ˆë¦¬ ì¸ìƒ ë§Œì§€ì‘", bad: true });
                }
                scenarios.push({ type: 'PRICE', impact: 0.3, delay: 3, msg: "GTX ë…¸ì„  í™•ì •! ì¸ê·¼ ë‹¨ì§€ í˜¸ê°€ ê»‘ì¶©", bad: false });
                scenarios.push({ type: 'PRICE', impact: -0.4, delay: 2, msg: "ë‹¨ì§€ ë‚´ ëŒ€í˜• ì‹±í¬í™€ ë°œìƒ! ë¶€ì‹¤ ê³µì‚¬ ì˜í˜¹", bad: true });
                scenarios.push({ type: 'RATE', impact: -0.2, delay: 1, msg: "ì •ë¶€ 'ì£¼ê±° ì•ˆì •' ìœ„í•´ ëŒ€ì¶œ ê·œì œ ì™„í™”", bad: false });
                return scenarios[Math.floor(Math.random() * scenarios.length)];
            };

            const yearsPassed = Math.floor(month / 12);
            const currentYear = START_YEAR + yearsPassed;
            const currentMonthDisplay = (month % 12) + 1;
            const inflationFactor = Math.pow(1.002, month); 

            const formatMoney = (amount) => {
                if (amount === undefined || amount === null) return "0";
                const absAmount = Math.abs(amount);
                if (absAmount >= 10000) {
                    const jo = Math.floor(absAmount / 10000);
                    const eok = Math.floor(absAmount % 10000);
                    return `${jo}ì¡°${eok > 0 ? eok.toFixed(0) : ''}ì–µ`;
                }
                return `${absAmount.toFixed(0)}ì–µ`;
            };

            const formatPrice = (amount) => amount.toFixed(1) + "ì–µì›";
            const formatUnitCost = (amount) => `ì„¸ëŒ€ë‹¹ ${amount.toFixed(1)}ì–µ`;

            const getComment = (cash) => {
                if (cash < 0) return "ì•¼ë°˜ë„ì£¼ ì¤€ë¹„í•˜ì…¨ë‚˜ìš”?";
                if (cash < 100) return "ì „ì„¸ê¸ˆ ë¹¼ì„œ ì‹œì‘í–ˆëŠ”ë°...";
                if (cash < 500) return "ì´ì œ ë°¥ê°’ì€ í•˜ê³  ì‚¬ë„¤ìš”.";
                if (cash < 2000) return "ì„±ê³µí•œ ì‚¬ì—…ê°€! ê³¨í”„ ì¹˜ëŸ¬ ê°€ì‹œì£ .";
                return "ë‹¹ì‹ ì€ ë¶€ë™ì‚°ì˜ ì „ì„¤ì…ë‹ˆë‹¤.";
            };

            const getFinalResult = (cash) => {
                const score = Math.floor(cash);
                let title = "";
                let desc = "";
                let color = "";

                if (score < -500) {
                    title = "ì „ì„¤ì˜ ì‹ ìš©ë¶ˆëŸ‰ì";
                    const descs = [
                        "ì „ìƒì— ë‚˜ë¼ë¥¼ íŒ”ì•„ë¨¹ìœ¼ì…¨ë‚˜ìš”? ë¹šì´ ê°ë‹¹ ë¶ˆê°€ì…ë‹ˆë‹¤.",
                        "ì€í–‰ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ëª…ì˜ˆì˜ ì „ë‹¹ 1ìœ„ ë“±ê·¹.",
                        "ì‹ ì²´ í¬ê¸° ê°ì„œ ì“°ëŸ¬ ê°€ì‹œì£ ...",
                        "ë‹¤ìŒ ìƒì—ëŠ” ëŒë©©ì´ë¡œ íƒœì–´ë‚˜ì„¸ìš”."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-red-600";
                } else if (score < 0) {
                    title = "ì•¼ë°˜ë„ì£¼ ì „ë¬¸ê°€";
                    const descs = [
                        "í•œê°• ë¬¼ ì˜¨ë„ê°€ ë”°ëœ»í•´ ë³´ì´ë„¤ìš”...",
                        "ì—¬ê¶Œ ì±™ê¸°ì„¸ìš”. ë°° íƒ€ê³  ë°€í•­í•©ì‹œë‹¤.",
                        "ë¹šìŸì´ë“¤ì´ ì§‘ ì•ì— í…íŠ¸ ì³¤ìŠµë‹ˆë‹¤.",
                        "ë§ˆì´ë„ˆìŠ¤ì˜ ì†! ë‹¿ëŠ” ê²ƒë§ˆë‹¤ ë§í•˜ë„¤ìš”."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-red-500";
                } else if (score < 100) {
                    title = "í¸ì˜ì  ë„ì‹œë½ ë§¤ë‹ˆì•„";
                    const descs = [
                        "ì „ì„¸ê¸ˆ ë¹¼ì„œ ì‹œì‘í–ˆëŠ”ë° ì›ë£¸ ë³´ì¦ê¸ˆë§Œ ë‚¨ì•˜ë„¤ìš”.",
                        "ê·¸ë˜ë„ ë¹šì€ ì—†ìœ¼ë‹ˆ ë‹¤í–‰...ì¼ê¹Œìš”?",
                        "íì§€ ì¤ëŠ” ë¦¬ì–´ì¹´ í•˜ë‚˜ ì¥ë§Œí•˜ì…”ì•¼ê² ìŠµë‹ˆë‹¤.",
                        "15ë…„ ë™ì•ˆ ìˆ¨ë§Œ ì‰¬ê³  ì¼í–ˆëŠ”ë° ë‚¨ì€ ê²Œ ì—†ë„¤ìš”."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-gray-400";
                } else if (score < 300) {
                    title = "ì„œë¯¼ì˜ ì‚¶";
                    const descs = [
                        "ë”± ì…ì— í’€ì¹ í•  ì •ë„ì…ë‹ˆë‹¤. ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤.",
                        "ì¹˜í‚¨ ì‹œí‚¬ ë•Œ ë°°ë‹¬ë¹„ ê³ ë¯¼ì€ í•´ì•¼ í•©ë‹ˆë‹¤.",
                        "ì„œìš¸ ì•„íŒŒíŠ¸ëŠ” ê¿ˆë„ ëª» ê¾¸ê³  ë¹Œë¼ ì „ì„¸ ì •ë„?",
                        "ì—´ì‹¬íˆ ì‚¬ì…¨ëŠ”ë°... í‹°ê°€ ì•ˆ ë‚˜ë„¤ìš”."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-gray-300";
                } else if (score < 500) {
                    title = "ë™ë„¤ ìœ ì§€";
                    const descs = [
                        "ë‚˜ì˜ì§€ ì•Šì•„ìš”. ë™ë„¤ì—ì„œ 'ì‚¬ì¥ë‹˜' ì†Œë¦¬ëŠ” ë“£ê² ë„¤ìš”.",
                        "ê·¸ëœì € ì •ë„ëŠ” ë½‘ì„ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.",
                        "ë…¸í›„ ê±±ì •ì€ ëœì—ˆì§€ë§Œ ìì‹í•œí…Œ ë¬¼ë ¤ì¤„ ê±´ ì—†ë„¤ìš”.",
                        "í‰ë²”í•˜ê²Œ ì„±ê³µí•œ ì‚¶. ë°•ìˆ˜ ì§ì§ì§."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-green-400";
                } else if (score < 1000) {
                    title = "ì„±ê³µí•œ ì¤‘ì‚°ì¸µ";
                    const descs = [
                        "ì´ì œ ë°±í™”ì  ê°€ê²©í‘œ ì•ˆ ë³´ê³  ì‚¬ì…”ë„ ë©ë‹ˆë‹¤.",
                        "ì™¸ì œì°¨ ë§¤ì¥ ê°€ì„œ 'ì´ê±° ì¤˜' ì‹œì „ ê°€ëŠ¥.",
                        "ì£¼ë³€ì—ì„œ ëˆ ë¹Œë ¤ë‹¬ë¼ëŠ” ì—°ë½ ì¢€ ì˜¤ê² ëŠ”ë°ìš”?",
                        "ê°•ë‚¨ ì…ì„±ì€ í˜ë“¤ì–´ë„ ë§ˆìš©ì„±ì€ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-green-300";
                } else if (score < 3000) {
                    title = "ê°•ë‚¨ ê±´ë¬¼ì£¼";
                    const descs = [
                        "ì„±ê³µí•œ ì‚¬ì—…ê°€! ê³¨í”„ íšŒì›ê¶Œ ì§€ë¥´ì‹œì£ .",
                        "ìˆ¨ë§Œ ì‰¬ì–´ë„ ì›”ì„¸ê°€ ë“¤ì–´ì˜¤ëŠ” ì‚¶.",
                        "ë‹¹ì‹ ì˜ ì„±ê³µ ìŠ¤í† ë¦¬, ì±…ìœ¼ë¡œ ë‚´ë„ ë˜ê² ìŠµë‹ˆë‹¤.",
                        "ìì‹ë“¤ì´ íš¨ë„ ê²½ìŸì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-blue-400";
                } else if (score < 5000) {
                    title = "ëŒ€í•œë¯¼êµ­ í°ì†";
                    const descs = [
                        "ì¬ë²Œ 3ì„¸ë„ ë‹¹ì‹  ì•ì—ì„  ê³ ê°œë¥¼ ìˆ™ì…ë‹ˆë‹¤.",
                        "ë‰´ìŠ¤ ê²½ì œë©´ì— ìì£¼ ë‚˜ì˜¤ì‹œê² êµ°ìš”.",
                        "ëˆìœ¼ë¡œ ë”°ê·€ë¥¼ ë•Œë ¤ë„ í•©ë²•ì¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤ (ë†ë‹´).",
                        "ì„¸ë¬´ì¡°ì‚¬ ì¡°ì‹¬í•˜ì„¸ìš”. ë„ˆë¬´ ë§ì´ ë²Œì—ˆìŠµë‹ˆë‹¤."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-purple-400";
                } else if (score < 10000) {
                    title = "ì‚´ì•„ìˆëŠ” ì „ì„¤";
                    const descs = [
                        "ê±¸ì–´ ë‹¤ë‹ˆëŠ” ëŒ€ê¸°ì—…. ë‹¹ì‹ ì´ ê³§ ê²½ì œì…ë‹ˆë‹¤.",
                        "ì²­ì™€ëŒ€ì—ì„œ ë°¥ ë¨¹ìê³  ì—°ë½ ì˜¤ê² ëŠ”ë°ìš”?",
                        "ëˆì„ ì„¸ë‹¤ê°€ ì§€ë¬¸ì´ ë‹³ì•„ ì—†ì–´ì¡ŒìŠµë‹ˆë‹¤.",
                        "í•œêµ­ ë¶€ë™ì‚°ì€ ë‹¹ì‹  ì†ë°”ë‹¥ ì•ˆì— ìˆìŠµë‹ˆë‹¤."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-yellow-400";
                } else {
                    title = "ì§€êµ¬ ì •ë³µì";
                    const descs = [
                        "í™”ì„± ê°ˆë„ë‹ˆê¹Œ~ ì¼ë¡  ë¨¸ìŠ¤í¬ì™€ ë§ì§± ê°€ëŠ¥.",
                        "ì´ ì •ë„ë©´ ë‚˜ë¼ í•˜ë‚˜ ì„¸ìš°ì‹œì£ .",
                        "ëˆìœ¼ë¡œ ê±´ë¬¼ì„ ë‹¦ê³ , ëˆìœ¼ë¡œ ë¶ˆì„ ë•Œì„¸ìš”.",
                        "ê²Œì„ì˜ ì‹ ! ê°œë°œìê°€ ë¬´ë¦ ê¿‡ì—ˆìŠµë‹ˆë‹¤."
                    ];
                    desc = descs[Math.floor(Math.random() * descs.length)];
                    color = "text-yellow-300";
                }

                return { title, desc, color };
            };

            const getTitle = (finalScore) => {
                const res = getFinalResult(finalScore);
                return { title: res.title };
            };

            const addLog = (msg) => {
                const currentY = START_YEAR + Math.floor(month / 12);
                const currentM = (month % 12) + 1;
                setLogs(prev => [`[${currentY}.${currentM}] ${msg}`, ...prev].slice(0, 3)); 
            };

            const submitScore = () => {
                if (!playerName.trim() || scoreSubmitted) return;
                const result = getFinalResult(cash);
                const newEntry = {
                    name: playerName.trim().substring(0, 8),
                    score: Math.floor(cash),
                    title: result.title,
                    timestamp: Date.now()
                };
                const currentLeaderboard = JSON.parse(localStorage.getItem('tycoon_leaderboard') || '[]');
                const updated = [...currentLeaderboard, newEntry];
                updated.sort((a, b) => b.score - a.score);
                localStorage.setItem('tycoon_leaderboard', JSON.stringify(updated));
                setLeaderboard(updated.slice(0, 10));
                setScoreSubmitted(true);
            };

            // --- Game Loop ---
            useEffect(() => {
                let interval = null;
                if ((gameState !== 'intro' && gameState !== 'ended' && gameState !== 'bankrupt' && gameState !== 'time_limit' && gameState !== 'retired' && gameState !== 'round_summary') && gameSpeed > 0) {
                    interval = setInterval(() => {
                        tick();
                    }, TICK_RATE);
                }
                return () => clearInterval(interval);
            }, [gameState, gameSpeed, month, marketRate, marketPrice, priceMomentum, activeLoan, cash, pendingEvents, landCostPerUnit, constCostPerUnit, totalUnits, fixedSalesPrice, peakPrice, salesBoostLeft]);

            const tick = () => {
                const nextMonth = month + 1;
                const nextYearVal = START_YEAR + Math.floor(nextMonth / 12);
                
                if (nextMonth >= TOTAL_GAME_MONTHS) {
                    setMonth(nextMonth);
                    setGameState('time_limit');
                    return;
                }

                setMonth(nextMonth);
                
                // NPC & News
                if (currentNews && currentNews.expireMonth <= nextMonth) setCurrentNews(null);
                if (npcMessage && npcMessage.expireMonth <= nextMonth) setNpcMessage(null);

                if (Math.random() < 0.15 && !npcMessage) {
                    const currentState = { marketRate, marketPrice, cash, debt: activeLoan, gameState, landCostPerUnit, projectMonth, fixedSalesPrice, soldUnits, unsoldUnits, salesBoostLeft };
                    // Simplified trigger check for robustness
                    const possibleEvents = NPC_EVENTS.filter(e => !e.trigger || e.trigger(currentState));
                    if (possibleEvents.length > 0) {
                        const event = possibleEvents[Math.floor(Math.random() * possibleEvents.length)];
                        if (Math.random() < (event.chance || 0.1) * 2) {
                            triggerNpcMessage(event.speaker, event.role, event.msg, event.icon, event.color);
                        }
                    }
                }

                if (Math.random() < 0.04 && pendingEvents.length < 1) { 
                    const newsItem = getNews(marketRate, marketPrice, landCostPerUnit);
                    const triggerMonth = nextMonth + newsItem.delay;
                    setPendingEvents(prev => [...prev, { ...newsItem, triggerMonth }]);
                    setCurrentNews({ msg: `[ì†ë³´] ${newsItem.msg}`, bad: newsItem.bad, expireMonth: nextMonth + 3 });
                    addLog(`ğŸ“¢ ì†ë³´: ${newsItem.msg}`);
                }

                let forcedRateChange = 0;
                let forcedMomentumChange = 0;
                const triggeredEvents = pendingEvents.filter(e => e.triggerMonth === nextMonth);
                const remainingEvents = pendingEvents.filter(e => e.triggerMonth !== nextMonth);
                if (triggeredEvents.length > 0) {
                    triggeredEvents.forEach(e => {
                        const impact = e.type === 'PRICE' ? e.impact * inflationFactor : e.impact;
                        if (e.type === 'RATE') forcedRateChange += impact;
                        else if (e.type === 'PRICE') forcedMomentumChange += impact * 0.2;
                        addLog(`ğŸ“° ë‰´ìŠ¤ ë°˜ì˜: ${e.msg}`);
                    });
                    setPendingEvents(remainingEvents);
                }
                
                // Market Logic
                const histData = HISTORICAL_TRENDS[nextYearVal] || { priceM: 1.8, rate: 4.0 };
                const targetBasePrice = 3.0 * histData.priceM * inflationFactor;
                
                let nextMomentum = priceMomentum * 0.92; 
                const priceGap = (targetBasePrice - marketPrice) / marketPrice;
                nextMomentum += priceGap * 0.03; 
                nextMomentum += (Math.random() - 0.5) * 0.04 + forcedMomentumChange;
                const inflationDrift = 0.002; 
                let nextPrice = marketPrice * (1 + nextMomentum + inflationDrift);
                
                if (nextPrice < 1.0) nextPrice = 1.0; 
                
                if (nextPrice > peakPrice) setPeakPrice(nextPrice);
                else {
                    const minAllowed = peakPrice * 0.7; 
                    if (nextPrice < minAllowed) {
                        nextPrice = minAllowed + (Math.random() * 0.01);
                        nextMomentum += 0.01;
                    }
                }

                setPriceMomentum(nextMomentum);
                setPrevMarketPrice(marketPrice);
                setMarketPrice(parseFloat(nextPrice.toFixed(2)));

                const priceChangeRatio = (nextPrice - marketPrice) / marketPrice;
                let landChange = 0;
                if (priceChangeRatio > 0) landChange = priceChangeRatio * 0.7; 
                else landChange = priceChangeRatio * 0.5; 
                const nextLandCost = landCostPerUnit * (1 + landChange + 0.001); 
                setLandCostPerUnit(parseFloat(nextLandCost.toFixed(2)));
                setConstCostPerUnit(prev => parseFloat((prev * 1.002).toFixed(2)));

                const targetRate = histData.rate;
                let rateDiff = targetRate - marketRate;
                let nextRate = marketRate + (rateDiff * 0.08) + ((Math.random() - 0.5) * 0.3) + forcedRateChange;
                if (nextRate < MIN_RATE) nextRate = MIN_RATE;
                if (nextRate > MAX_RATE) nextRate = MAX_RATE; 
                setMarketRate(parseFloat(nextRate.toFixed(2)));

                setWarningMsg(null); 

                // Game State
                if (gameState === 'land_owned') {
                    const monthlyInterest = (activeLoan * (fixedInterestRate / 100)) / 12;
                    setCash(prev => parseFloat((prev - monthlyInterest).toFixed(2)));
                    if (cash < -20) { setGameState('bankrupt'); return; }
                }

                if (gameState === 'under_construction') {
                    const currentP = projectMonth + 1;
                    setProjectMonth(currentP);
                    
                    const monthlyInterest = (activeLoan * (fixedInterestRate / 100)) / 12;
                    let revenue = 0;
                    let sold = 0;

                    if (unsoldUnits > 0) {
                        let baseSalesRate = 0;
                        if (currentP <= 6) baseSalesRate = 0.05; 
                        else if (currentP <= 24) baseSalesRate = 0.02; 
                        else baseSalesRate = 0.01; 

                        const priceRatio = marketPrice / fixedSalesPrice; 
                        let marketFactor = 1.0;
                        if (priceRatio >= 1.0) {
                            marketFactor = Math.pow(priceRatio, 12); 
                        } else {
                            if (priceRatio < 0.85) {
                                marketFactor = 0; 
                                setWarningMsg("â›” ì‹œì„¸ í­ë½! ë¶„ì–‘ ì¤‘ë‹¨");
                            } else {
                                marketFactor = Math.pow(priceRatio, 20); 
                            }
                        }

                        if (salesBoostLeft > 0) {
                            marketFactor = Math.max(marketFactor * 3.0, 0.5); 
                            setSalesBoostLeft(prev => prev - 1);
                        }

                        let salesVolume = Math.floor(totalUnits * baseSalesRate * marketFactor);
                        salesVolume = Math.min(salesVolume, unsoldUnits);

                        if (salesVolume > 0) {
                            revenue = salesVolume * fixedSalesPrice;
                            sold = salesVolume;
                            setUnsoldUnits(prev => prev - sold);
                            setSoldUnits(prev => prev + sold);
                            setTotalRevenue(prev => parseFloat((prev + revenue).toFixed(2)));
                            
                            if(salesVolume > totalUnits * 0.05 && Math.random() < 0.2) {
                                triggerNpcMessage("ì • ë¶„ì–‘íŒ€ì¥", "ì˜ì—…ì™•", "ì „í™”ê¸° í­ë°œí•©ë‹ˆë‹¤! ì§€ê¸ˆ ë¬¼ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤!", "fa-thumbs-up", "text-green-300");
                            }
                        }
                    }

                    setCash(prev => {
                        let nextCash = prev - monthlyInterest + revenue;
                        let currentLoan = activeLoan; 
                        const reserve = Math.max(10, monthlyInterest * 12);
                        let repayment = 0;

                        if (currentLoan > 0 && nextCash > reserve) {
                            repayment = Math.min(nextCash - reserve, currentLoan);
                            nextCash -= repayment;
                        }
                        
                        if (repayment > 0) {
                            setActiveLoan(prevLoan => parseFloat((prevLoan - repayment).toFixed(2)));
                            if (repayment > 10) addLog(`ğŸ’¸ ìë™ ìƒí™˜: ${formatMoney(repayment)}`);
                        }

                        if (nextCash < monthlyInterest * 6 && unsoldUnits > 0) {
                            setWarningMsg("âš ï¸ ìê¸ˆ ê³ ê°ˆ ìœ„í—˜! íŒŒì‚° ì§ì „!");
                        }
                        return parseFloat(nextCash.toFixed(2));
                    });

                    if (cash < -50) { setGameState('bankrupt'); return; }

                    if (unsoldUnits - sold === 0 && currentP < CONSTRUCTION_DURATION) endRound("sold_out");
                    else if (currentP >= CONSTRUCTION_DURATION) endRound("time_over");
                }

                // History (Zoom out)
                setHistory(prev => [...prev, { month: nextMonth, rate: nextRate, price: nextPrice }]);
            };

            // --- Actions ---
            const initGame = () => {
                setRound(1); setCash(70); setTotalUnits(100); setProjectCost(300); setTotalLoanAmount(270);
                setLandCostPerUnit(1.0); setConstCostPerUnit(2.0); setMarketPrice(2.5); setMarketRate(4.5);
                setPriceMomentum(0); setPeakPrice(2.5); setActiveLoan(0); setSalesBoostLeft(0);
                setHistory([]); setLogs([]); setPendingEvents([]); setCurrentNews(null); setNpcMessage(null); setWarningMsg(null);
                setMonth(0); setGameState('idle'); setScoreSubmitted(false); setPlayerName("");
                addLog("ê²Œì„ ì‹œì‘! 2000ë…„, ê¸°íšŒì˜ ë•….");
            };

            const buyLand = () => {
                if (gameState !== 'idle') return;
                const landLoan = totalLoanAmount * 0.3; 
                setActiveLoan(landLoan);
                setFixedInterestRate(marketRate); 
                setGameState('land_owned');
                addLog(`ğŸš© í† ì§€ ë§¤ì… (ëŒ€ì¶œ ${formatMoney(landLoan)})`);
                triggerNpcMessage("ê¹€ ë¹„ì„œ", "ì¼ì˜ëŸ¬", "í† ì§€ ê³„ì•½ ì™„ë£Œ! ì´ì œ ì´ì ë‚˜ê°€ë‹ˆê¹Œ ë¹¨ë¦¬ ì°©ê³µí•˜ì‹œì£ .", "fa-file-signature", "text-blue-300");
            };

            const startSales = () => {
                if (gameState !== 'land_owned') return;
                const constructionLoan = totalLoanAmount * 0.7; 
                setActiveLoan(prev => prev + constructionLoan);
                setFixedSalesPrice(marketPrice); 
                setProjectMonth(0);
                setUnsoldUnits(totalUnits);
                setSoldUnits(0);
                setGameState('under_construction');
                addLog(`ğŸ—ï¸ ì°©ê³µ (ë¶„ì–‘ê°€ ${formatMoney(marketPrice)})`);
                triggerNpcMessage("ë°• ê¸°íšíŒ€ì¥", "ì„¤ë ˆë°œ", "ëª¨ë¸í•˜ìš°ìŠ¤ ì˜¤í”ˆ! í™”í™˜ì´ 100ê°œë‚˜ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤!", "fa-ribbon", "text-pink-300");
            };

            const boostSales = () => {
                if (gameState !== 'under_construction' || unsoldUnits <= 0) return;
                const costPerUnit = 0.1; 
                const totalBoostCost = unsoldUnits * costPerUnit;
                if (cash < totalBoostCost) {
                    addLog("âš ï¸ í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                    return;
                }
                setCash(prev => parseFloat((prev - totalBoostCost).toFixed(2)));
                setSalesBoostLeft(3); 
                addLog(`ğŸ“£ ì¡°ì§ë¶„ì–‘ íˆ¬ì…!`);
                triggerNpcMessage("ìµœ ë§ˆì¼€íŒ…", "ì—´í˜ˆ", "ê±±ì • ë§ˆì‹­ì‡¼! ì œê°€ ì˜í˜¼ê¹Œì§€ ëŒì–´ëª¨ì•„ íŒ”ì•„ë³´ê² ìŠµë‹ˆë‹¤!", "fa-bullhorn", "text-yellow-400");
            };

            const endRound = (reason) => {
                setGameState('round_summary');
                setNpcMessage(null); setWarningMsg(null); setSalesBoostLeft(0);
                let liquidationValue = 0;
                if (unsoldUnits > 0) {
                    const dumpPrice = marketPrice * 0.8;
                    liquidationValue = unsoldUnits * dumpPrice; 
                    addLog(`ğŸ“‰ ë¯¸ë¶„ì–‘ ë–¨ì´ ì²˜ë¶„`);
                    triggerNpcMessage("ì´ ì¬ë¬´ì´ì‚¬", "ìš¸ìƒ", "ë¯¸ë¶„ì–‘ í„¸ì–´ëƒˆìŠµë‹ˆë‹¤... ì œ ì„±ê³¼ê¸‰ì€ ì—†ê² ì£ ?", "fa-face-sad-tear", "text-gray-400");
                } else {
                    addLog(`ğŸ‰ ì™„íŒ ë‹¬ì„±!`);
                    triggerNpcMessage("ì „ ì§ì›", "í™˜í˜¸", "ì™€ì•„ì•„!!! ì™„íŒì´ë‹¤!! ì‚¬ì¥ë‹˜ ë§Œì„¸!!", "fa-champagne-glasses", "text-yellow-300");
                }
                setCash(prevCash => parseFloat((prevCash + liquidationValue - activeLoan).toFixed(2)));
                setActiveLoan(0);
            };

            const startNextRound = () => {
                const nextRound = round + 1;
                setRound(nextRound);
                
                const nextUnitCost = landCostPerUnit + constCostPerUnit;
                const safeCash = Math.max(cash, 10); 
                const multiplier = 8; 
                
                const nextTotalBudget = Math.floor(safeCash * multiplier); 
                
                let nextTotalUnits = Math.floor(nextTotalBudget / nextUnitCost);
                if (nextTotalUnits < 100) nextTotalUnits = 100;
                if (nextTotalUnits > 10000) nextTotalUnits = 10000;

                const nextProjectCost = Math.floor(nextTotalUnits * nextUnitCost);
                const nextLoanAmount = Math.floor(nextProjectCost * 0.9); 
                
                setTotalUnits(nextTotalUnits); setProjectCost(nextProjectCost); setTotalLoanAmount(nextLoanAmount);
                setActiveLoan(0); setUnsoldUnits(nextTotalUnits); setSoldUnits(0); setTotalRevenue(0); setProjectMonth(0);
                setGameState('idle'); setLogs([]);
                addLog(`ë¼ìš´ë“œ ${nextRound} ì‹œì‘.`);
            };

            const currentResult = getFinalResult(cash);

            // --- UI Components ---
            const SalesProgressBar = ({ total, sold }) => {
                const percentage = Math.round((sold / total) * 100);
                return (
                    <div className="w-full mt-2">
                        <div className="flex justify-between text-xs mb-1 text-gray-400">
                            <span>ë¶„ì–‘ë¥ </span>
                            <span className="text-white font-bold">{percentage}% ({sold}/{total}ì„¸ëŒ€)</span>
                        </div>
                        <div className="w-full h-4 bg-gray-700 rounded-full overflow-hidden relative shadow-inner">
                            <div className="h-full bg-gradient-to-r from-blue-500 to-cyan-400 transition-all duration-300 flex items-center justify-center text-[10px] font-bold text-white shadow-[0_0_10px_rgba(59,130,246,0.5)]" style={{ width: `${Math.max(percentage, 5)}%` }}>
                                {percentage}%
                            </div>
                        </div>
                    </div>
                );
            };

            const ProgressBar = ({ current, total, color="bg-blue-500", label="" }) => {
                const percentage = Math.min(100, Math.round((current / total) * 100));
                return (
                    <div className="w-full mt-2">
                        <div className="flex justify-between text-xs mb-1 text-gray-400">
                            <span>{label}</span>
                            <span className="text-white font-bold">{percentage}%</span>
                        </div>
                        <div className="w-full h-4 bg-gray-700 rounded-full overflow-hidden relative shadow-inner">
                            <div className={`h-full ${color} transition-all duration-300`} style={{ width: `${percentage}%` }}></div>
                        </div>
                    </div>
                );
            };

            const SmoothLineChart = ({ data }) => {
                if (!data || data.length < 2) return <div className="h-28 flex items-center justify-center bg-gray-900 text-gray-500 text-xs">ë°ì´í„° ìˆ˜ì§‘ ì¤‘...</div>;
                const width = 100; const height = 50;
                
                const prices = data.map(d => d.price);
                // Zoom out scale logic
                let minP = Math.min(...prices, 2.0) * 0.8;
                let maxP = Math.max(...prices, 5.0) * 1.1;

                const getPath = (key, minVal, maxVal) => {
                    const points = data.map((d, i) => {
                        // Zoom out: Map entire history to width
                        const x = (i / (data.length - 1 || 1)) * width;
                        const val = d[key] !== undefined ? d[key] : minVal;
                        const y = height - ((val - minVal) / (maxVal - minVal)) * height;
                        return [x, y];
                    });
                    if (points.length === 0) return "";
                    let d = `M ${points[0][0]},${points[0][1]}`;
                    for (let i = 0; i < points.length - 1; i++) {
                        const x0 = points[i][0]; const y0 = points[i][1];
                        const x1 = points[i + 1][0]; const y1 = points[i + 1][1];
                        const cp1x = (x0 + x1) / 2; const cp1y = y0;
                        const cp2x = (x0 + x1) / 2; const cp2y = y1;
                        d += ` C ${cp1x},${cp1y} ${cp2x},${cp2y} ${x1},${y1}`;
                    }
                    return d;
                };

                return (
                    <div className="relative w-full h-28 bg-gray-900 rounded border border-gray-700 overflow-hidden">
                        <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full preserve-3d">
                            <line x1="0" y1={height/2} x2={width} y2={height/2} stroke="#333" strokeWidth="0.5" strokeDasharray="2" />
                            <path d={getPath('rate', 0, 15)} fill="none" stroke="#ef4444" strokeWidth="1" opacity="0.6"/>
                            <path d={getPath('price', minP, maxP)} fill="none" stroke="#22c55e" strokeWidth="1.5" />
                        </svg>
                        <div className="absolute top-0.5 left-1 text-[9px] text-green-400 font-bold">ì•„íŒŒíŠ¸ 35í‰ ì‹œì„¸</div>
                        <div className="absolute bottom-0.5 left-1 text-[9px] text-red-400 font-bold">ëŒ€ì¶œê¸ˆë¦¬</div>
                    </div>
                );
            };

            // --- Render ---
            return (
                <div className="w-full h-full bg-gray-800 shadow-xl overflow-hidden relative flex flex-col font-sans">
                    
                    {/* Header */}
                    <div className="bg-gray-900 border-b border-gray-700 shrink-0 p-3 flex justify-between items-center h-14">
                        <div>
                            <h1 className="text-base font-bold text-yellow-500 flex items-center gap-1"><i className="fa-solid fa-building"></i> ë¶€ë™ì‚° ê°œë°œ : íƒ€ì´ë°ì˜ ìŠ¹ë¶€ì‚¬</h1>
                            <div className="flex gap-3 text-xs text-gray-400 mt-0.5">
                                <span>R{round}</span>
                                <span className="flex items-center gap-1"><i className="fa-regular fa-clock"></i> {currentYear}.{currentMonthDisplay}</span>
                            </div>
                        </div>
                        <div className="flex gap-2 items-center">
                            {warningMsg && <span className="text-xs text-red-500 font-bold animate-pulse">{warningMsg}</span>}
                            <button onClick={() => setGameSpeed(prev => prev === 0 ? 1 : 0)} className="w-8 h-8 bg-gray-700 rounded flex items-center justify-center text-sm hover:bg-gray-600 transition-colors">
                                <i className={`fa-solid ${gameSpeed === 0 ? 'fa-play' : 'fa-pause'}`}></i>
                            </button>
                        </div>
                    </div>

                    {/* NPC Message */}
                    <div className="h-16 bg-gray-800 border-b border-gray-700 p-2 flex items-center gap-3 relative overflow-hidden shrink-0">
                        {npcMessage ? (
                            <>
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center shrink-0 border-2 ${npcMessage.color || 'text-white'} bg-gray-700 text-lg`}>
                                    <i className={`fa-solid ${npcMessage.icon || 'fa-user'}`}></i>
                                </div>
                                <div className="flex-1 animate-fade-in-up overflow-hidden">
                                    <div className="flex items-center gap-1.5 mb-0.5">
                                        <span className="font-bold text-yellow-400 text-xs">{npcMessage.speaker}</span>
                                        <span className="text-[10px] text-gray-400 px-1.5 py-0.5 bg-gray-900 rounded-full">{npcMessage.role}</span>
                                    </div>
                                    <p className="text-xs text-white leading-tight">"{npcMessage.msg}"</p>
                                </div>
                            </>
                        ) : (
                            <div className="w-full text-center text-gray-500 text-xs italic">(ì‚¬ë¬´ì‹¤ì´ ì¡°ìš©í•©ë‹ˆë‹¤...)</div>
                        )}
                    </div>

                    {/* Content */}
                    <div className="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3 relative">
                        
                        {gameState === 'intro' && (
                            <div className="absolute inset-0 z-50 bg-gray-900/95 flex flex-col items-center justify-center p-6 text-center">
                                <h1 className="text-2xl font-bold text-yellow-500 mb-4">ë¶€ë™ì‚° ê°œë°œ : íƒ€ì´ë°ì˜ ìŠ¹ë¶€ì‚¬</h1>
                                <p className="text-sm text-gray-300 mb-8 leading-relaxed">
                                    2010ë…„ ~ 2025ë…„, ê²©ë™ì˜ 15ë…„.<br/>
                                    ê¸ˆë¦¬ë¥¼ ì½ê³ , ì‹œì„¸ë¥¼ ì˜ˆì¸¡í•˜ì—¬<br/>
                                    ëŒ€í•œë¯¼êµ­ ìµœê³ ì˜ ë””ë²¨ë¡œí¼ê°€ ë˜ì„¸ìš”.
                                </p>
                                <button onClick={initGame} className="px-8 py-3 bg-blue-600 hover:bg-blue-500 rounded-lg text-base font-bold animate-pulse shadow-lg transition-transform active:scale-95">ê²Œì„ ì‹œì‘</button>
                                <div className="absolute bottom-5 right-5 text-xs text-gray-600">ë§Œë“ ì´: ê¶Œì˜íƒœ</div>
                            </div>
                        )}
                        {gameState === 'round_summary' && (
                            <div className="absolute inset-0 z-50 bg-gray-900/95 flex flex-col items-center justify-center p-6 text-center">
                                <h2 className="text-xl font-bold text-white mb-2">Round {round} ì¢…ë£Œ</h2>
                                <p className="text-3xl font-bold text-green-400 mb-4">{formatMoney(cash)}</p>
                                <div className="bg-gray-800 p-4 rounded-lg w-full mb-6 border border-gray-700">
                                    <p className="text-sm text-yellow-300 italic">"{getFinalResult(cash).desc}"</p>
                                </div>
                                {currentYear < END_YEAR ? (
                                    <button onClick={startNextRound} className="px-8 py-3 bg-green-600 hover:bg-green-500 rounded-lg text-base font-bold shadow-lg">ë‹¤ìŒ ë¼ìš´ë“œ</button>
                                ) : (
                                    <button onClick={() => setGameState('time_limit')} className="px-8 py-3 bg-yellow-600 hover:bg-yellow-500 rounded-lg text-base font-bold shadow-lg">ìµœì¢… ê²°ê³¼</button>
                                )}
                            </div>
                        )}
                        {['ended', 'bankrupt', 'time_limit', 'retired'].includes(gameState) && gameState !== 'intro' && (
                            <div className="absolute inset-0 z-50 bg-gray-900/95 flex flex-col items-center justify-center p-6 text-center">
                                <h2 className="text-2xl font-bold text-white mb-1">{gameState === 'bankrupt' ? 'íŒŒì‚°' : 'ê²Œì„ ì¢…ë£Œ'}</h2>
                                <p className="text-4xl font-bold text-yellow-400 mb-6">{formatMoney(cash)}</p>
                                <p className={`text-lg mb-4 font-bold ${currentResult.color}`}>{currentResult.title}</p>
                                <div className="bg-gray-800 p-4 rounded-lg w-full mb-6 border border-gray-700">
                                    <p className="text-sm text-gray-300 italic">"{currentResult.desc}"</p>
                                </div>
                                <div className="bg-gray-800 p-4 rounded-lg w-full max-w-sm mb-6 border border-gray-700">
                                    {!scoreSubmitted ? (
                                        <div className="flex gap-2">
                                            <input type="text" placeholder="ì´ë¦„ ì…ë ¥" className="flex-1 p-3 bg-gray-900 rounded text-center text-sm border border-gray-600 focus:border-yellow-500 outline-none text-white" value={playerName} onChange={(e) => setPlayerName(e.target.value)} maxLength={8}/>
                                            <button onClick={submitScore} disabled={!playerName.trim()} className="px-5 bg-yellow-600 hover:bg-yellow-500 rounded text-sm font-bold text-white transition-colors disabled:opacity-50">ë“±ë¡</button>
                                        </div>
                                    ) : (
                                        <div className="text-sm text-left space-y-1 h-32 overflow-y-auto">
                                            {leaderboard.map((item, idx) => (
                                                <div key={idx} className="flex justify-between p-2 bg-gray-900 rounded border border-gray-800"><span className="text-gray-300">{idx+1}. {item.name}</span><span className="text-green-400 font-bold">{formatMoney(item.score)}</span></div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <button onClick={initGame} className="px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-white font-bold transition-colors">ë‹¤ì‹œ í•˜ê¸°</button>
                            </div>
                        )}

                        {/* Chart */}
                        <div className="p-3 bg-gray-850 rounded-lg border border-gray-700/50">
                            <div className="flex justify-between text-xs mb-2">
                                <span className="text-green-400 font-bold flex items-center gap-1"><i className="fa-solid fa-chart-line"></i> ì•„íŒŒíŠ¸ 35í‰ ì‹œì„¸ {formatPrice(marketPrice)}</span>
                                <span className="text-red-400 font-bold flex items-center gap-1"><i className="fa-solid fa-percent"></i> ëŒ€ì¶œê¸ˆë¦¬ {marketRate.toFixed(1)}%</span>
                            </div>
                            <SmoothLineChart data={history} />
                        </div>

                        {/* Player Stats */}
                        <div className="grid grid-cols-2 gap-2 text-sm bg-gray-800 p-3 rounded-lg border border-gray-700">
                            <div className="flex flex-col items-center border-r border-gray-600">
                                <span className="text-gray-400 text-xs mb-1"><i className="fa-solid fa-coins"></i> ë³´ìœ  í˜„ê¸ˆ</span>
                                <span className={`font-bold text-xl ${cash < 0 ? 'text-red-500' : 'text-white'}`}>{formatMoney(cash)}</span>
                            </div>
                            <div className="flex flex-col items-center">
                                <span className="text-gray-400 text-xs mb-1"><i className="fa-solid fa-file-invoice-dollar"></i> ëŒ€ì¶œ ì”ì•¡</span>
                                <span className="font-bold text-xl text-red-400">{formatMoney(activeLoan)}</span>
                            </div>
                        </div>

                        {/* Status Card (Compact UI) */}
                        <div className="bg-gray-800 p-3 rounded-lg border border-gray-700 shadow-md">
                            {gameState === 'idle' && (
                                <div className="text-sm space-y-1">
                                    <div className="flex justify-between font-bold text-yellow-400 border-b border-gray-600 pb-1">
                                        <span><i className="fa-solid fa-clipboard-list"></i> ì‹ ê·œ ì‚¬ì—… ê³„íš</span>
                                        <span>{totalUnits}ì„¸ëŒ€</span>
                                    </div>
                                    <div className="flex justify-between"><span>ì˜ˆìƒ ì›ê°€:</span> <span>{formatUnitCost(projectCost/totalUnits)}</span></div>
                                    <div className="flex justify-between"><span>ì˜ˆìƒë¶„ì–‘ìˆ˜ìµ (ì´ìì°¨ê°):</span> 
                                        <span className={(marketPrice*totalUnits - projectCost - (totalLoanAmount * (marketRate/100)/12 * CONSTRUCTION_DURATION)) > 0 ? "text-green-400 font-bold" : "text-red-400 font-bold"}>
                                            {formatMoney((marketPrice * totalUnits) - projectCost - (totalLoanAmount * (marketRate/100)/12 * CONSTRUCTION_DURATION))}
                                        </span>
                                    </div>
                                </div>
                            )}
                            {gameState === 'land_owned' && (
                                <div className="text-sm space-y-1">
                                    <div className="flex justify-between font-bold text-blue-400 border-b border-gray-600 pb-1">
                                        <span><i className="fa-solid fa-flag"></i> í† ì§€ ë³´ìœ  ì¤‘</span>
                                        <span>ì´ì {fixedInterestRate}%</span>
                                    </div>
                                    <div className="flex justify-between"><span>ì†ìµë¶„ê¸°:</span> <span>{formatUnitCost(landCostPerUnit + constCostPerUnit)}</span></div>
                                    <div className="flex justify-between"><span>ì˜ˆìƒë¶„ì–‘ìˆ˜ìµ (ì´ìì°¨ê°):</span> 
                                        <span className={`font-bold ${(marketPrice * totalUnits - projectCost - (totalLoanAmount * (fixedInterestRate/100)/12 * CONSTRUCTION_DURATION)) > 0 ? 'text-green-400' : 'text-red-500'}`}>
                                            {formatMoney((marketPrice * totalUnits) - projectCost - (totalLoanAmount * (fixedInterestRate/100)/12 * CONSTRUCTION_DURATION))}
                                        </span>
                                    </div>
                                </div>
                            )}
                            {gameState === 'under_construction' && (
                                <div className="text-sm space-y-1">
                                    <div className="flex justify-between font-bold text-green-400 border-b border-gray-600 pb-1">
                                        <span><i className="fa-solid fa-hammer"></i> ë¶„ì–‘ ì§„í–‰ ì¤‘</span>
                                        <span>ë¶„ì–‘ê°€ {formatMoney(fixedSalesPrice)}</span>
                                    </div>
                                    <ProgressBar current={soldUnits} total={totalUnits} label="ë¶„ì–‘ë¥ " color="bg-gradient-to-r from-blue-500 to-cyan-400" />
                                    <ProgressBar current={projectMonth} total={CONSTRUCTION_DURATION} label="ê³µì •ë¥ " color="bg-orange-500" />
                                    <div className="text-center text-xs text-gray-400 mt-2">
                                        {salesBoostLeft > 0 ? <span className="text-yellow-400 animate-pulse font-bold">âš¡ ì¡°ì§ë¶„ì–‘ íŒ€ ê°€ë™ ì¤‘!</span> : 
                                         (marketPrice > fixedSalesPrice ? 'ğŸ”¥ ì¸ê¸° í­ë°œ (ì‹œì„¸ ìƒìŠ¹)' : 'â„ï¸ ë¶„ì–‘ ì €ì¡° (ì‹œì„¸ í•˜ë½)')}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Logs */}
                        <div className="space-y-1 px-1">
                            {logs.map((log, i) => (
                                <div key={i} className="text-[11px] text-gray-500 truncate border-b border-gray-800/50 pb-1">{log}</div>
                            ))}
                        </div>
                    </div>

                    {/* Footer Controls */}
                    <div className="shrink-0 bg-gray-900 p-3 border-t border-gray-700">
                        {gameState === 'idle' && (
                            <button onClick={buyLand} className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg shadow-lg active:scale-95 transition-all flex justify-between px-6 items-center">
                                <span className="text-lg"><i className="fa-solid fa-signature"></i> í† ì§€ ë§¤ì…</span>
                                <span className="text-xs font-normal opacity-80 bg-blue-700 px-2 py-1 rounded">ëŒ€ì¶œ {formatMoney(totalLoanAmount*0.3)}</span>
                            </button>
                        )}
                        {gameState === 'land_owned' && (
                            <button onClick={startSales} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg shadow-lg active:scale-95 transition-all flex justify-between px-6 items-center">
                                <span className="text-lg"><i className="fa-solid fa-bullhorn"></i> ë¶„ì–‘ ê°œì‹œ</span>
                                <span className="text-xs font-normal opacity-80 bg-green-700 px-2 py-1 rounded">ì¶”ê°€ëŒ€ì¶œ {formatMoney(totalLoanAmount*0.7)}</span>
                            </button>
                        )}
                        {gameState === 'under_construction' && (
                            <button 
                                onClick={boostSales} 
                                disabled={salesBoostLeft > 0}
                                className={`w-full py-4 rounded-lg font-bold shadow-lg active:scale-95 transition-all flex justify-between px-6 items-center ${salesBoostLeft > 0 ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : 'bg-purple-600 hover:bg-purple-500 text-white'}`}
                            >
                                <span className="text-lg"><i className="fa-solid fa-people-group"></i> ì¡°ì§ë¶„ì–‘ íˆ¬ì…</span>
                                <span className="text-xs font-normal opacity-80 bg-black/20 px-2 py-1 rounded">ë¹„ìš© {formatMoney(unsoldUnits * 0.1)}</span>
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const ProgressBar = ({ current, total, color="bg-blue-500", label="" }) => {
            const percentage = Math.min(100, Math.round((current / total) * 100));
            return (
                <div className="w-full mt-2">
                    <div className="flex justify-between text-xs mb-1 text-gray-400">
                        <span>{label}</span>
                        <span className="text-white font-bold">{percentage}%</span>
                    </div>
                    <div className="w-full h-4 bg-gray-700 rounded-full overflow-hidden relative shadow-inner">
                        <div className={`h-full ${color} transition-all duration-300`} style={{ width: `${percentage}%` }}></div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RealEstateTycoon />);
    </script>
</body>
</html>